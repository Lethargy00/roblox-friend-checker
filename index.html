<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Roblox Friend Checker</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="./css/styles.css">
</head>

<body class="bg-[#FFC1C9] flex flex-col text-[#804151]">

    <header>
        <h1 class="text-center text-5xl font-bold mb-8 mt-8">Roblox Friend Checker</h1>

    </header>

    <div class="bg-[#FFE1E6] m-4 p-4 rounded-xl flex flex-wrap justify-around">
        <div class="flex gap-2">
            <input type="text" id="userId1" class="bg-[#BA7A7C] p-2 focus:outline-2 focus:outline-[#804151] rounded-xl"
                pattern="[0-9]" placeholder="username">
            <button onclick="getFriends()"
                class="bg-[#FFC1C9] hover:bg-[#D4969E] hover:cursor-pointer p-2 px-4 rounded-xl">Search
                Friends</button>
        </div>
        <div id="secondInputSection" class="flex gap-2">
            <input type="text" id="userId2" class="bg-[#BA7A7C] p-2 focus:outline-2 focus:outline-[#804151] rounded-xl"
                pattern="[0-9]" placeholder="Friend's username">
            <button onclick="checkFriend()"
                class="bg-[#FFC1C9] hover:bg-[#D4969E] hover:cursor-pointer  p-2 px-4 rounded-xl">Check for
                Match</button>
        </div>
    </div>

    <p id="result-count-paragraph" class="bg-[#BA7A7C] mx-4 mb-4 p-4 rounded-xl self-start hidden">Found <span
            id="result-count"></span>
        friends.</p>

    <div id="result-header" class="bg-[#FFE1E6] mx-4 mb-4 p-4 rounded-xl grid grid-cols-3 hidden">
        <div>Name</div>
        <div>Display Name</div>
        <div>ID</div>
    </div>


    <svg viewBox="0 0 16 16" id="loading-svg" xmlns="http://www.w3.org/2000/svg" fill="none"
        class="loading h-15 w-15 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 hidden">

        <g fill="#87474E" fill-rule="evenodd" clip-rule="evenodd">

            <path d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8z" opacity=".2" />

            <path d="M7.25.75A.75.75 0 018 0a8 8 0 018 8 .75.75 0 01-1.5 0A6.5 6.5 0 008 1.5a.75.75 0 01-.75-.75z" />

        </g>

    </svg>

    <div id="result" class="bg-[#FFE1E6] mx-4 p-4 rounded-xl grid grid-cols-3 max-h-[60vh] overflow-y-auto hidden">

        <!-- <div>RixityRick</div>
        <div>RixityRick</div>
        <div>72393075</div>
        <div>RixityRick</div>
        <div>RixityRick</div>
        <div>72393075</div>
        <div>RixityRick</div>
        <div>RixityRick</div>
        <div>72393075</div>
        <div>RixityRick</div>
        <div>RixityRick</div>
        <div>72393075</div>
        <div>RixityRick</div>
        <div>RixityRick</div>
        <div>72393075</div> -->


    </div>

    <div onclick="closeFriendMatch()" id="dark-background"
        class="bg-black/30 w-[100vw] h-[100vh] absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 cursor-pointer hidden">

    </div>

    <div id="friend-match"
        class="bg-[#FFE1E6] p-16 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 rounded-xl flex items-center justify-center hidden">

    </div>

    <script>
        let resolvedUserId = null;
        const searchInput = document.getElementById('userId1');
        searchInput.addEventListener('input', debounce(handleInput, 300));
        const secondSearchInput = document.getElementById('secondInputSection');
        secondSearchInput.addEventListener('input', debounce(handleInput, 300));

        function handleInput(event) {
            const query = event.target.value;

            let body = {
                "usernames": [
                    query
                ],
                "excludeBannedUsers": false
            }

            if (query.length > 0) {
                fetch('https://corsproxy.io/?https://users.roblox.com/v1/usernames/users', {
                    method: 'POST',
                    headers: {
                    },
                    body: JSON.stringify(body)
                }).then(response => response.json())
                    .then(data => {
                        if (data.data && data.data.length > 0) {
                            resolvedUserId = data.data[0].id;
                        } else {
                            resolvedUserId = null;
                        }
                    });
            } else {
                resultsDiv.innerHTML = '';
            }
        }

        function debounce(func, delay) {
            let timeout;
            return function (...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        let friendsList = [];
        const resultDiv = document.getElementById('result');

        function getFriends() {
            resultDiv.innerText = '';
            const userId = resolvedUserId;


            if (!userId) {
                alert('Please enter a valid username.');
                return;
            }

            const loadingDiv = document.getElementById('loading-svg');
            loadingDiv.style.display = 'block';

            fetch(`https://corsproxy.io/?https://friends.roblox.com/v1/users/${userId}/friends/`)
                .then(response => response.json())
                .then(data => {
                    friendsList = data.data || [];

                    if (friendsList.length === 0) {
                        const resultCountParagraph = document.getElementById('result-count-paragraph');

                        resultCountParagraph.innerHTML = 'No friends found for this user.';
                    } else {

                        const resultCount = document.getElementById('result-count');

                        resultCount.innerText = friendsList.length;

                        let number = 0;

                        friendsList.forEach(friend => {
                            const tableCell1HTML = document.createElement('div');
                            const tableCell2HTML = document.createElement('div');
                            const tableCell3HTML = document.createElement('div');

                            tableCell1HTML.classList.add('p-1', 'pl-3', 'mb-1', 'rounded-l-lg');
                            tableCell2HTML.classList.add('p-1', 'mb-1');
                            tableCell3HTML.classList.add('p-1', 'pr-3', 'mb-1', 'rounded-r-lg');


                            if (number % 2 == 0) {
                                tableCell1HTML.classList.add('bg-[#FFD4DB]');
                                tableCell2HTML.classList.add('bg-[#FFD4DB]');
                                tableCell3HTML.classList.add('bg-[#FFD4DB]');
                            }

                            tableCell1HTML.innerText = friend.name;
                            tableCell2HTML.innerText = friend.displayName;
                            tableCell3HTML.innerText = friend.id;

                            resultDiv.appendChild(tableCell1HTML);
                            resultDiv.appendChild(tableCell2HTML);
                            resultDiv.appendChild(tableCell3HTML);

                            number++;
                        });
                        document.getElementById('loading-svg').style.display = 'none';
                        document.getElementById('result').style.display = 'grid';
                        document.getElementById('result-header').style.display = 'grid';
                        document.getElementById('result-count-paragraph').style.display = 'block';
                        document.getElementById('secondInputSection').style.display = 'flex';
                    }
                })
                .catch(error => {
                    console.error('Error fetching friends:', error);
                    resultDiv.innerText = 'Error fetching friends. Check the username and try again.';
                });
        }

        function checkFriend() {
            const secondId = resolvedUserId;

            const friendMatch = document.getElementById('friend-match');

            if (secondId) {
                let matchHtml = '❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found! ❌ No match found!';
                friendsList.forEach(friend => {
                    if (friend.id === secondId) {
                        document.getElementById('friend-match').style.display = 'flex';
                        document.getElementById('dark-background').style.display = 'block';
                        matchHtml = `✅ Match Found!\nName: ${friend.name}, Display Name: ${friend.displayName}`;
                        return;
                    }
                    document.getElementById('friend-match').style.display = 'flex';
                    document.getElementById('dark-background').style.display = 'block';
                });
                friendMatch.innerHTML = matchHtml;
            }

            document.getElementById('secondInputSection').style.display = 'block';
        }

        function closeFriendMatch() {
            document.getElementById('friend-match').style.display = 'none';
            document.getElementById('dark-background').style.display = 'none';
        }
    </script>
</body>

</html>